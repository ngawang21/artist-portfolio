---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { useTranslations } from '../i18n/utils';

const t = useTranslations('en');

// Get all artworks from content collection
const artworksEntries = await getCollection('artworks');
const artworks = artworksEntries.map(entry => ({
  id: entry.id,
  slug: entry.id,
  title: {
    en: entry.data.title_en,
    fr: entry.data.title_fr
  },
  description: {
    en: entry.data.description_en,
    fr: entry.data.description_fr
  },
  image: entry.data.image,
  dimensions: entry.data.dimensions,
  price: entry.data.price,
  year: entry.data.year,
  medium: entry.data.medium,
  sold: entry.data.sold,
  featured: entry.data.featured,
  mollieLink: entry.data.mollie_link
}));

// Sort by year (newest first), then by featured status
artworks.sort((a, b) => {
  if (a.featured && !b.featured) return -1;
  if (!a.featured && b.featured) return 1;
  return b.year - a.year;
});
---

<BaseLayout title="Gallery - Artist Portfolio">
  <section class="py-20">
    <div class="container mx-auto px-4">
      <h1 class="font-serif text-5xl md:text-6xl font-bold text-center mb-4">
        {t('gallery.title')}
      </h1>
      <p class="text-center text-gray-600 text-lg mb-16 max-w-2xl mx-auto">
        Explore my collection of contemporary artworks, each piece telling its own unique story.
      </p>
      
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {artworks.map((artwork) => (
          <div 
            id={artwork.slug}
            class="group bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300"
          >
            <div class="aspect-[4/3] overflow-hidden relative">
              <img 
                src={artwork.image} 
                alt={artwork.title.en}
                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                loading="lazy"
              />
              {artwork.sold && (
                <div class="absolute inset-0 bg-black/60 flex items-center justify-center">
                  <span class="bg-white text-primary px-6 py-2 rounded-md font-bold text-lg">
                    {t('gallery.sold')}
                  </span>
                </div>
              )}
            </div>
            
            <div class="p-6">
              <h3 class="font-serif text-2xl font-semibold mb-2">{artwork.title.en}</h3>
              <p class="text-gray-600 mb-4 line-clamp-2">{artwork.description.en}</p>
              
              <div class="space-y-2 mb-4 text-sm text-gray-500">
                <p><strong>{t('gallery.dimensions')}:</strong> {artwork.dimensions}</p>
                <p><strong>Medium:</strong> {artwork.medium}</p>
                <p><strong>Year:</strong> {artwork.year}</p>
              </div>
              
              <div class="flex items-center justify-between">
                <span class="text-2xl font-bold text-primary">
                  â‚¬{artwork.price.toLocaleString()}
                </span>
                {!artwork.sold && (
                  <a 
                    href={`/checkout/${artwork.slug}`}
                    class="bg-primary text-white px-6 py-2 rounded-md hover:bg-primary/90 transition-colors"
                  >
                    {t('gallery.buyNow')}
                  </a>
                )}

              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

